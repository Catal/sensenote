<script>
$(document).ready(function()
      {
        $('#note_group_ids').select2(
          {
            minimumInputLength: 1,
            placeholder: "グループを選択してください"
          }
        );
      }
);
</script>

<%= form_for(@note) do |f| %>
  <% if @note.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@note.errors.count, "") %> 個のエラーがありました:</h2>

      <ul>
      <% @note.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <div class="col-md-6">
      <h3><%= f.label :date %></h3>
      <%= DateTime.now.strftime('%Y-%m-%d') %>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <h3><%= f.label :title %></h3>
      <%= f.text_field :title, class: "form-control"%>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <h3><%= f.label :body %></h3><br>
      <%= f.cktext_area :body %>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <h3><%= f.label :グループ %></h3>
      <% @options = User.find(current_user.id).groups.collect{|g| [g.name, g.id]}.insert(0, "ノートを作成するグループを選択してください") %>
      <%= f.select :group_ids, @options, {}, :multiple => "true", class: "form-control" %>
    </div>
  </div>

  <br>
  <div class="row">
    <div class="col-md-6">
      <%= f.submit "作成", class: "btn btn-primary" %>
    </div>
  </div>
<% end %>


<head>
  <title>Pusher Test</title>
  <script src="//js.pusher.com/2.2/pusher.min.js" type="text/javascript"></script>
  <script type="text/javascript">

    var pusher = new Pusher('be77e6f1a3890641c69f');
    var channel = pusher.subscribe('test_channel');
    channel.bind('my_event', function(data) {
      //document.getElementById("note_title").value = data;
      document.getElementsByTagName('iframe')[0].contentWindow.document.body.innerHTML = data;
    });
  </script>
</head>

<div id="test"></div>

<script type="text/javascript">
  $(function(){
    var pusher  = new Pusher("<%= 'pusher-key' %>");
    var channel = pusher.subscribe("test_channel");
    channel.bind("my_event", function(html) {
      $("ul").prepend(html);
    });
  });
  $(document).ready(function(){
    $("#post").click(function(){
    //document.attachEvent('onkeydown',function(){
      //console.log("pressed");
      $.ajax({
        type: "POST",
        url: "/notes/push",
        data: "text="+escape(document.getElementsByTagName('iframe')[0].contentWindow.document.body.innerHTML),
        success: function() {},
      });
    });
  })
</script>
<input id="post" class="btn btn-default" value="送信">